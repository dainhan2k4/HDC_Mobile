<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Trading Page Template -->
    <template id="portal_trading_page" name="Trading Portal Page">
        <t t-call="web.layout">
            <t t-set="title">Tài khoản giao dịch</t>
            
            <!-- Import Bootstrap CSS and other dependencies -->
            <t t-set="head">
                <!-- Bootstrap CSS -->
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
                <!-- Bootstrap Icons -->
                <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"/>
                <!-- Font Awesome -->
                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
                <!-- Custom CSS -->
                <link rel="stylesheet" href="/stock_trading/static/src/css/trading_portal.css"/>
            </t>
            
            <!-- Header Container -->
            <div id="header-container"></div>
            
            <!-- Main Content Container - OWL Component sẽ render layout ở đây -->
            <div id="trading_portal_page">
                <!-- OWL Component sẽ render layout -->
            </div>
            
            <!-- Pass data to OWL component -->
            <t t-set="investor_data" t-value="{'id': investor.id if investor else None, 'name': investor.partner_name if investor else '', 'account_number': investor.account_number if investor else ''} if investor else None"/>
            <t t-set="config_data" t-value="{'id': config.id if config else None, 'consumer_id': config.consumer_id if config else '', 'account': config.account if config else ''} if config else None"/>
            <t t-set="balance_data" t-value="{'cash_balance': balance.cash_balance if balance else 0, 'available_cash': balance.available_cash if balance else 0, 'purchasing_power': balance.purchasing_power if balance else 0, 'last_sync': balance.last_sync.strftime('%Y-%m-%d %H:%M:%S') if balance and balance.last_sync else ''} if balance else None"/>
            <script type="text/javascript">
                <t t-set="investor_json" t-value="json.dumps(investor_data) if investor_data else 'null'"/>
                <t t-set="config_json" t-value="json.dumps(config_data) if config_data else 'null'"/>
                <t t-set="balance_json" t-value="json.dumps(balance_data) if balance_data else 'null'"/>
                window.tradingPortalData = {
                    investor: <t t-raw="investor_json"/>,
                    config: <t t-raw="config_json"/>,
                    balance: <t t-raw="balance_json"/>,
                };
            </script>
            <!-- CSRF Token Meta Tag -->
            <t t-set="csrf_token" t-value="request.csrf_token()"/>
            <meta name="csrf-token" t-att-content="csrf_token"/>
            
            <!-- Bootstrap JS -->
            <t t-set="js">
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            </t>
            
            <t t-call-assets="web.assets_frontend" t-js="true"/>
        </t>
    </template>
</odoo>

