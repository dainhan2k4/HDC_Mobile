<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_list.report_transaction_pdf_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <h2>Báo cáo giao dịch</h2>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>Công ty:</strong> <span t-esc="company_name"/></p>
                        <p><strong>Ngày xuất:</strong> <span t-esc="export_time"/></p>
                        <p><strong>Người xuất:</strong> <span t-esc="user_name"/></p>
                        <p><strong>Tổng số giao dịch:</strong> <span t-esc="total_records"/></p>
                        
                        <t t-if="selected_product">
                            <p><strong>Quỹ:</strong> <span t-esc="selected_product"/></p>
                        </t>
                        
                        <t t-if="from_date or to_date">
                            <t t-if="from_date">
                                <p><strong>Từ ngày:</strong> <span t-esc="from_date"/></p>
                            </t>
                            <t t-if="to_date">
                                <p><strong>Đến ngày:</strong> <span t-esc="to_date"/></p>
                            </t>
                        </t>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Phiên giao dịch</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Số tài khoản</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Nhà đầu tư</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Quỹ</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Loại lệnh</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Số CCQ</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Giá tiền</th>
                                <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Tổng số tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="records" t-as="record">
                                <tr>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.transaction_date">
                                            <span t-esc="record.transaction_date.strftime('%d/%m/%Y')"/>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.user_id and record.user_id.partner_id">
                                            <span t-esc="record.user_id.partner_id.name"/>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.user_id">
                                            <span t-esc="record.user_id.name"/>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.fund_id">
                                            <span t-esc="record.fund_id.name"/>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.transaction_type == 'purchase'">Lệnh mua</t>
                                        <t t-elif="record.transaction_type == 'sell'">Lệnh bán</t>
                                        <t t-elif="record.transaction_type == 'exchange'">Hoán đổi</t>
                                        <t t-else="">
                                            <span t-esc="record.transaction_type"/>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.units">
                                            <span t-esc="'{:,.0f}'.format(record.units)"/>
                                        </t>
                                        <t t-else="">
                                            <span>0</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.units and record.amount and record.units != 0">
                                            <span t-esc="'{:,.0f}'.format(record.amount / record.units)"/>
                                        </t>
                                        <t t-else="">
                                            <span>0</span>
                                        </t>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">
                                        <t t-if="record.amount">
                                            <span t-esc="'{:,.0f}'.format(record.amount)"/>
                                        </t>
                                        <t t-else="">
                                            <span>0</span>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </template>
</odoo>
