<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="nav_transaction_page" name="NAV Phiên giao dịch">
        <t t-call="web.layout">
            <t t-set="title">NAV Phiên giao dịch</t>

            <!-- Import CSS -->
            <t t-set="head">
                <!-- Bootstrap CSS -->
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
                <!-- Bootstrap Icons -->
                <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"/>
                <!-- Font Awesome -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
            </t>

            <!-- Header Container for Management -->
            <div id="headermana-container"></div>

            <!-- Main Container -->
            <div class="nav-management-fund-overview-container">
                <div class="container-fluid py-4">
                    <!-- Loading Spinner -->
                    <div id="loading-spinner" class="nav-management-loading-container">
                        <div class="nav-management-loading-spinner">
                            <div class="nav-management-spinner-border" role="status">
                                <span class="visually-hidden">Đang tải...</span>
                            </div>
                            <div class="nav-management-loading-text">Đang tải dữ liệu...</div>
                        </div>
                    </div>
                    
                    <!-- Error Container (hidden by default) -->
                    <div id="error-container" class="nav-management-error-container" style="display: none;">
                        <div class="nav-management-error-icon">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <h4 class="nav-management-error-title">Có lỗi xảy ra</h4>
                        <p class="nav-management-error-message" id="error-message">Không thể tải dữ liệu</p>
                        <button class="nav-management-btn nav-management-btn-primary mt-3" onclick="location.reload()" style="background-color:#f97316;border-color:#f97316">
                            <i class="bi bi-arrow-clockwise me-2"></i>
                            Thử lại
                        </button>
                    </div>
                    
                    <!-- Widget Container -->
                    <div id="navTransactionWidget" class="w-100" style="display: none;"></div>
                </div>
            </div>

            <!-- Pass data from controller to JavaScript -->
            <script type="text/javascript">
                window.navTransactionData = {
                    funds: <t t-raw="funds_json"/>,
                    selected_fund_id: <t t-raw="selected_fund_id_json"/>
                };
                
                // Hàm tiện ích để hiển thị lỗi
                window.showError = function(message) {
                    const errorContainer = document.getElementById('error-container');
                    const errorMessage = document.getElementById('error-message');
                    const loadingSpinner = document.getElementById('loading-spinner');
                    const widgetContainer = document.getElementById('navTransactionWidget');
                    
                    if (errorContainer &amp;&amp; errorMessage) {
                        errorMessage.textContent = message || 'Có lỗi xảy ra khi tải dữ liệu';
                        errorContainer.style.display = 'block';
                    }
                    
                    if (loadingSpinner) {
                        loadingSpinner.style.display = 'none';
                    }
                    
                    if (widgetContainer) {
                        widgetContainer.style.display = 'none';
                    }
                };
                
                // Hàm tiện ích để ẩn spinner và hiển thị widget
                window.hideSpinner = function() {
                    const loadingSpinner = document.getElementById('loading-spinner');
                    const errorContainer = document.getElementById('error-container');
                    const widgetContainer = document.getElementById('navTransactionWidget');
                    
                    if (loadingSpinner) {
                        loadingSpinner.style.display = 'none';
                    }
                    
                    if (errorContainer) {
                        errorContainer.style.display = 'none';
                    }
                    
                    if (widgetContainer) {
                        widgetContainer.style.display = 'block';
                    }
                };
                
                
            </script>

            <!-- Import JavaScript -->
            <t t-set="js">
                <!-- Bootstrap JS -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            </t>

            <t t-call-assets="web.assets_frontend" t-js="true"/>
        </t>
    </template>
</odoo>
