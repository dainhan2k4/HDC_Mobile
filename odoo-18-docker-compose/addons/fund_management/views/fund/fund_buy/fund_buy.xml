<odoo>
  <template id="fund_buy" name="Fund Buy Page">
    <t t-call="web.layout">
      <t t-set="title">Đặt lệnh mua</t>

      <t t-call-assets="web.assets_frontend" t-js="true" />
      <t t-set="head">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="/fund_management/static/src/css/fund_buy.css"/>
      </t>

<!--      <t t-call="fund_management.fund_header_template"/>-->

      <div id="header-container"></div>

      <div class="profile-container fm">
        <div class="max-w-7xl mx-auto bg-white rounded-lg shadow p-6 rounded-4 mt-4">
          <div class="bg-white rounded-4 px-3 py-3">


            <nav class="navbar navbar-expand-lg navbar-light bg-white rounded-4 shadow-sm mb-4 px-3 border py-2 " >
              <div class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav d-flex w-100 justify-content-center fs-5">
                  <li class="nav-item flex-fill text-center">
                    <a class="fw-bold px-2 nav-link-blue nav-link-active" href="fund_buy">Mua</a>
                  </li>
                  <li class="nav-item flex-fill text-center">
                    <a class="px-2 nav-link-blue" href="fund_sell">Bán</a>
                  </li>
                  <li class="nav-item flex-fill text-center">
                    <a class="px-2 nav-link-blue" href="#">Chuyển đổi</a>
                  </li>
                </ul>
              </div>
            </nav>


            <!-- Bước tiến trình -->
            <div class="progress-steps mx-auto" style="max-width: 500px;">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <!-- Bước 1 -->
                <div class="text-center">
                  <div class="step-circle active">1</div>
                  <small class="d-block mt-2">Đặt lệnh</small>
                </div>

                <div class="flex-grow-1 mx-2 border-top position-relative" style="top: -18px;"></div>

                <!-- Bước 2 -->
                <div class="text-center">
                  <div class="step-circle">2</div>
                  <small class="d-block mt-2">Xác nhận</small>
                </div>

                <div class="flex-grow-1 mx-2 border-top position-relative" style="top: -18px;"></div>

                <!-- Bước 3 -->
                <div class="text-center">
                  <div class="step-circle">3</div>
                  <small class="d-block mt-2">Kết quả</small>
                </div>
              </div>
            </div>


            <!-- Main Form -->
            <div class="row">
              <!-- Form Input -->
              <div class="col-md-7">
                <div class="card p-4 shadow-sm rounded-4">
                  <h5 class="mb-4">Đặt lệnh mua</h5>

                  <form id="fund-buy-form">
                    <div class="row mb-3 align-items-center">
                      <label for="fund-select" class="col-sm-4 col-form-label">Chọn sản phẩm <span class="text-danger">*</span></label>
                      <div class="col-sm-8">
                        <input id="fund-search" type="text" class="form-control mb-2" placeholder="Tìm theo tên/mã CCQ..." />
                        <!-- Giữ select để logic JS dùng, nhưng ẩn khỏi giao diện -->
                        <select id="fund-select" class="form-select" style="display:none" aria-hidden="true" tabindex="-1"></select>
                      </div>
                    </div>

                    <!-- Giá trị 1 cổ phiếu -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Giá CCQ</label>
                      <div class="col-sm-8">
                        <div id="current-nav" class="form-control text-end">...</div>
                      </div>
                    </div>

                    <div class="mb-3" style="display: none;">
                      <label class="form-label">ID</label>
                      <div id="current-id" class="form-control bg-light">...</div>
                    </div>

                    <!-- Nhập số tiền đầu tư -->
                    <div class="mb-3 row align-items-center">
                      <label for="investment-amount-input" class="col-sm-4 col-form-label">
                        Số tiền đầu tư<span class="text-danger">*</span>
                      </label>
                      <div class="col-sm-8">
                        <input type="text" id="investment-amount-input" class="form-control text-end" placeholder="Nhập số tiền đầu tư"/>
                        <div class="form-text text-warning">Số tiền đầu tư tối thiểu 1,000,000đ</div>
                      </div>
                    </div>

                    <!-- Nhập số CCQ muốn mua -->
                    <div class="mb-3 row align-items-center">
                      <label for="share-quantity-input" class="col-sm-4 col-form-label">
                        Số lượng CCQ<span class="text-danger">*</span>
                      </label>
                      <div class="col-sm-8">
                        <input type="number" id="share-quantity-input" class="form-control text-end" placeholder="Nhập số lượng CCQ hoặc số tiền đầu tư"/>
                      </div>
                    </div>


                    <div class="mb-3" style="display: none;">
                      <label class="form-label">Giá trị lệnh mua</label>
                      <input id="amount-input" type="text" class="form-control bg-light" placeholder="0" readonly="1"/>
                      <div class="form-text text-warning">Số tiền đầu tư tối thiểu 1,000,000đ</div>
                    </div>

                    <!-- Chọn kỳ hạn -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Chọn kỳ hạn - Lãi suất <span class="text-danger">*</span></label>
                      <div class="col-sm-8">
                        <select id="term-select" class="form-select" onchange="handleTermChange(this.value)">
                          <option value="" selected="selected" disabled="disabled">-- Đang tải kỳ hạn --</option>
                        </select>
                      </div>
                    </div>

                    <!-- Lãi suất -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Lãi suất</label>
                      <div class="col-sm-8">
                        <div id="interest-rate" class="form-control text-end">...</div>
                      </div>
                    </div>

                    <!-- Giá bán khi đáo hạn -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Giá bán khi đáo hạn</label>
                      <div class="col-sm-8">
                        <div id="maturity-price" class="form-control text-end">...</div>
                      </div>
                    </div>

                    <!-- Giá trị nhận được sau đáo hạn -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Giá trị nhận được sau đáo hạn</label>
                      <div class="col-sm-8">
                        <div id="final-value" class="form-control text-end fw-bold" style="font-size: 1.1rem;">...</div>
                      </div>
                    </div>


                    <!-- Phí mua -->
                    <div class="mb-3 row align-items-center">
                      <label class="col-sm-4 col-form-label">Phí mua</label>
                      <div class="col-sm-8">
                        <input id="fee-input" type="text" class="form-control text-end text-dark" value="0" readonly="1"/>
                      </div>
                      <a href="#" class="form-text text-end" data-bs-toggle="modal" data-bs-target="#feeModal">Xem biểu phí</a>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Investment Summary -->
              <div class="col-md-5">
                <div class="card p-4 shadow-sm rounded-4 mb-3">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Thông tin đầu tư</h5>
                    <a href="#" class="form-text" data-bs-toggle="modal" data-bs-target="#termsModal">Xem điều khoản</a>
                  </div>

                  <ul class="list-group list-group-flush border rounded-3">
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Quỹ đầu tư</span>
                      <strong id="summary-fund-name">FCTEST</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Loại lệnh</span>
                      <strong>Mua</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Ngày đặt lệnh</span>
                      <strong id="buy-order-date">...</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Kỳ hạn</span>
                      <strong id="summary-term">...</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Lãi suất</span>
                      <strong id="summary-interest">...</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Số tiền đầu tư</span>
                      <strong id="summary-investment-amount">0đ</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Số tiền mua CCQ</span>
                      <strong id="summary-amount">0đ</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Phí mua</span>
                      <strong id="summary-fee">0đ</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Tổng thanh toán</span>
                      <strong id="summary-total">0đ</strong>
                    </li>


                    <li class="list-group-item d-flex justify-content-between">
                      <span>Tổng số CCQ</span>
                      <strong id="summary-units">0</strong>
                    </li>

                    <li class="list-group-item d-flex justify-content-between">
                      <span>Ngày đáo hạn</span>
                      <strong id="maturity-date">...</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span>Ngày bán lại</span>
                      <strong id="resale-date">...</strong>
                    </li>

                  </ul>

                  <!-- Debug Mode Toggle -->
                  <div class="mt-3 pt-3 border-top">
                    <label class="d-flex align-items-center justify-content-between cursor-pointer">
                      <div class="d-flex align-items-center">
                        <i class="fas fa-bug text-orange-500 me-2"></i>
                        <span class="text-sm fw-medium">Debug Mode</span>
                        <span class="ms-2 text-xs text-muted">(Bỏ qua kiểm tra lãi trong ngưỡng)</span>
                      </div>
                      <div class="fund-debug-toggle">
                        <input type="checkbox" id="fund-buy-debug-toggle" class="fund-debug-toggle-input"/>
                        <span class="fund-debug-toggle-slider"></span>
                      </div>
                    </label>
                    <p id="fund-buy-debug-warning" class="mt-2 text-xs text-orange-600 fw-medium" style="display: none;">
                      <i class="fas fa-exclamation-triangle me-1"></i>
                      Chế độ debug đang bật - Bỏ qua kiểm tra lãi trong ngưỡng
                    </p>
                  </div>

                  <div class="d-flex justify-content-between mt-4">
                      <button type="button" class="btn btn-pill btn-sell" id="back-btn">Quay lại</button>
                      <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-secondary" id="debug-btn">DEBUG</button>
                        <button type="button" class="btn btn-pill btn-buy" id="payment-btn">Thanh toán</button>
                      </div>
                  </div>
                </div>


              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ Modal biểu phí -->
      <t t-call="fund_management.fee_template"/>
      <t t-call="fund_management.terms_modal_template"/>
      <t t-call="fund_management.signature_modal_template"/>

    </t>
  </template>
</odoo>
